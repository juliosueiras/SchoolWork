<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>Creating a Class Library</title>
<script type="text/javascript" src="scripts/header.js"></script>
<link rel="stylesheet" type="text/css" href="css/prog.css">


</head>

<body  onload='window.focus()'>

<h2>Creating a Class Library</h2>

<h3>Topics Covered:</h3>

<ul class="outer">
	<li><a href="#library">Code Libraries</a>
    <li><a href="#prelim">Preliminary Steps</a>
	<li><a href="#libPrj">Creating the Library Project</a>
	<li><a href="#add">Adding Existing Classes to Library</a>
    <li><a href="#jar">Create the JAR File</a></li>
    <li><a href="#toLib">Add the JAR to the Library</a></li>
    <li><a href="#using">Using Your Library</a></li>
    <li><a href="#ex">Exercises</a></li>
</ul>

<p><b>Note:</b>  If you did not do the Shapes Hierarchy exercise,
    (Shape, ThreeD, Circle, Sphere, Cylinder, Square, Cube) then
    you will need to
    <a href="files/shapes.zip">download the source code files</a>
    for this class.</p>

<a name="library"><h3>Code Libraries</h3></a>

<p>You're getting to a point where you will be re-using a lot of your
code (methods, constants, etc).  Up to now, you've probably been
copying and pasting re-used code from one program to another.  This
is not a desireable solution.  One of the main ideas behind
object-oriented programming is to be able to reuse your code by
calling a particular method or referring to a particular constant
as needed.  It's actually fairly easy to implement this!  All you
need to do is create a location and set of files where you will store your
classes, methods, and constants, and then tell Java where it can
find everything when you use your library in your programs.</p>

<p>The class or classes in which you organize and store your reusable
code is commonly referred to as a <b>"code library"</b>, or
<b>"library of functions"</b>.  To learn how a code library works,
we'll start by making our Shape hierarchy of classes available to other
programs and projects.</p>

<a name="prelim"></a>
<h3>Preliminary Steps</h3>

<!--
<p>You should keep your library source code in a separate folder so
that it's easier to maintain.  In your regular programs folder for
Java, create a folder called "librarysource".  We also keep the
actual class files separate from the source files, so you will also
need a folder in your programs folder called "library".  Make sure
you have both of these folders created right in the root of your
programs folder.</p>
-->

<h4>Choosing a Library Directory</h4>

<p>First, you need to set up a location for your class library files.
You can pick any location on your computer, but I prefer to use a "library"
directory in my main coding directory.  For this tutorial, I'm going
to set up the library directory right in the root of the prog24178
directory.  For example:</p>

<pre>D:\Courses\Winter09\prog24178\library</pre>

<p>Since some of you will be taking other programming courses, you might
want to choose a location that is not term- or course-specific; you might
prefer something more "central" to other programs you will be writing
in the future.  Regarldess, for the rest of this tutorial, I'll refer to
this directory as <b>"the library directory"</b>.</p>

<h4>Come up With a Package Name</h4>

<p>Earlier in the course, we discussed <a href="packages.html">packages</a>.
By now you've either come up with your own package name (according to
industry standards, of course) or you've been using something course-related
such as the course code followed by the unit name or week number, e.g. 
prog24178.swinggui or prog24178.weekX (where X is the week number).
If haven't been creating your own package name, you will
need to go back and review the material on Packages before continuing.</p>

<p>Choose a root name for your package.  As mentioned previously, you
can use your domain name if you have one, or you can use prog24178 if
you don't have your own domain or you don't wish to use it.</p>

<p>For this tutorial, I'll be using prog24178.  The hierarchy of shape
classes are going to be in a package called prog24178.shapes.  If you
choose your own domain name, just stick ".shapes" on the end to
come up with the package name for this tutorial.  For example, my
domain package name is wsj.terminallearning, so I would use
wsj.terminallearning.shapes.</p>

<p>For the rest of this tutorial, I'll use prog24178.shapes as the package
name and refer to it as the <b>"shapes package"</b>.</p>

<p>Once you've created a library directory and determined the name
of your package, you will need to locate and open
the project that contained the Shape class hierarchy we worked on at
the beginning of term (Shape, Circle, Cylinder, etc).  If you don't have
this project, you can copy the source files from the course discussion
board.</p>

<p>Open up the Shapes project (If you followed the in-class demo, it's
probably called OOPReview or Inheritance or something similar).  Open up the
Source Packages node and make sure all the files are there.</p>

<a name="libPrj"></a>
<h3>Creating the Library Project</h3>

<p>In this tutorial, we are creating the library based on existing
source code.  You can also follow these steps to create a new library
of code from scratch, or to refactor old code to create a library
of code you've been using frequently.</p>

<ol>
    <li>Create a new project by selecting File/New Project in the main
    menu.</li>
    <li>In the New Project dialog, make sure "Java" is selected under
    the Categories list.  In the Projects: list, select "Java Class
    Library".</li>
    <li>In the next window, you'll be asked to enter a name for this
    project.  This project name will also be the name of your JAR
    file.  For example, here I would enter prog24178-shapes and my
    JAR file will be called prog24178-shapes.jar</li>
    <li>Click the Finish button.</li>
</ol>

<div class="puzzle">If you prefer, you can give the project one name
and then give the JAR file a different name after you create the
project:<br />
Switch to the Files window (it's behind the Projects window, just click
the Files tab) and go to the "nbproject" folder in your project's folder
Then, open project.properties node - this is a file with a whole bunch
of property settings.  When you open the node, you'll see each setting
listed, to edit a setting, just double-click that setting and the
project.properties file will open up in the editor window.  Your cursor
should be positioned near the property you wish to edit.<br />
To change the JAR file name, locate and edit the <b>dist.jar</b>
property.</div>

<p>When you create a class library project, there's no package - only
the default package appears:  find and open the Source Packages node.
You should see the default package listed, but with nothing in it.</p>

<p>You need to create the shapes package discussed earlier:</p>
<ol>
    <li>Right click the Source Packages node and select "New" from the context menu.</li>
    <li>Select "Java Package".</li>
    <li>Enter the package name(e.g. prog24178.shapes) and click the Finish button.</li>
</ol>

<p>Your library project is now ready!  If you are creating a library
from scratch, you can now add classes and code just as you would in
any other project.  See the instructions below on how to create a JAR
for your project, put it into your library, and use it in other programs.</p>


<!--
<a name="setup"><h3>Setting It Up</h3></a>

<h4>Setting the CLASSPATH</h4>

<p>Now we have to make sure that Java knows where to look for things
in our library.  Normally when you compile and run a program, Java
will look for classes in the lib directories of the Java install
folders.  When you refer to a class such as String or JOptionPane,
Java knows that it will find the definition for those classes in its
own libraries.  If you use a class name that it doesn't recognize,
it tries to find that class definition in your current application's
folder (that's why you sometimes class ClassDefNotFound - class
definition not found - errors when you use a class name that Java
doesn't know and you haven't created!).  Under this system, If we
have code that we want to use in multiple programs, we'd have to
have copies of that code in the folders of all the applications that
use that code!  Think of what that would mean if you wanted to change
your reused code!  You'd have to change every single copy of the class
that contains the code!  To solve this problem, we tell Java that
there is a third location to check when trying to find a class name -
our library folder!</p>

<p>The <b><font face="Courier New">classpath</font></b> environment variable gives Java a list of locations it should search when trying to find a class you've referred to in your programs and classes.  (If you've ever programmed in DOS, this is just like the DOS "PATH" command!)  You might have already worked with the classpath variable - if you did "Robots" in Logic course, you had to set the classpath variable to the location of the becker.robots packages and classes.</p>

<p>To edit the classpath variable:</p>
<ul class="outer">
<li>From the Start menu in Windows, open the Control Panel.
<li>Open the <b>System</b> tool.
<li>Click the <b>Advanced Tab</b>, then click the <b>Environment Variables</b> button.
<li>In the lower part of the window, check to see if a classpath environment variable already exists.
<li>If the classpath variable exists:
	<ul class="inner">
	<li>Select it and click the <b>Edit</b> button below the list of variables.
	<li>Make sure the <font face="Courier New"></b>.;</b></font> (dot semi-colon) characters are in front of the current variable value.
	<li>Go to end of the text in the variable value field and add a ; (semi-colon).  Then add the complete path to programs/library folder (i.e. D:\courses\prog24178\programs\library)
	<li>Click OK.
	</ul>
<li>If the classpath variable doesn't exist:
	<ul class="inner">
	<li>Click the New below bottom variable list.
	<li>For the Variable Name field, type  <b><font face="Courier New">classpath</font></b>
	For the Variable Value field, type <b><font face="Courier New">.;</font></b> (dot semi-colon), then type the complete path to programs/library (i.e. D:\courses\prog24178\programs\library)
	<li>Click OK.
	</ul>
<li>Click OK on all the dialogs until you are out of the System tool.
<li>Close EditPlus and restart it.
</ul>
-->


<a name="add"><h3>Adding Existing Classes to the Library</h3></a>

<p>We now need to add the shape hierarchy of classes to the library project.
Be careful!  You have two projects open right now:  the library project
you just created from scratch, and the old shapes project from week 2/3.</p>

<!--
<p>If your shapes classes already have a package statement, and that
statement does not contain the package name prog24178.shapes, you need
to fix this by refactoring:</p>

<ol>
    <li>Right-click the package in your shapes project and select Refactor,
    then select Rename.</li>
    <li>Enter the new package name (e.g. prog24178.shapes) and click the
    Refactor button.</li>
</ol>
-->
<p>These next steps copy the shape classes into your library project:</p>

<ol>
    <li>Go to your OOP project where your Shape classes are stored.</li>
    <li>Select all of the source files in this project (Shape.java,
    Circle.java, Cylinder.java, Sphere.java, Square.java, and
    Cube.java -- <b>DO NOT</b> select the Test class, if you have one) and
    copy them to the clipboard (e.g. Ctrl-C).</li>
    <li>Go to the library project you created earlier in this tutorial.</li>
    <li>Select your library project's prog24178.shapes package.</li>
    <li>Use the paste command (e.g. Ctrl-V) to paste the shape classes
    into the prog24178.shapes package.</li>
</ol>

<p>Now, if you open the library project's Source Packages node, you
should see the 7 source files the prog24178.shapes package.</p>

<a name="jar"></a>
<h3>Create the JAR file</h3>

<p>A JAR (Java ARchive) file is a file that can contain a set of
Java classes (such as a code library) or that can be an actual Java
program.  Later in the course, you'll learn how to deploy Java programs
by compiling them into a JAR file.  A user can then run your program
simply by double-clicking the JAR file in file manager, or by creating
a desktop shortcut or menu item to it!  However, for now, we'll start
off by creating a JAR file with the set of shape classes we'll be
using in other programs.</p>

<p>Creating a JAR in Netbeans is extremely simple.  The only thing
you need to worry about is whether it's created automatically when you
compile, or not.</p>

<p>If you have the "Compile on Save" option turned off
(see project properties in the Build/Compile node) then your JAR file
is probably being created and updated each time you manually build
the program.</p>

<p>If you have this option turned on (most of you probably
do) then you need to create the JAR yourself.  To do this, just
right-click the project node and select "Clean and Build" from the
context menu.  Do this now to create the JAR for your shapes package.</p>

<p>Once your JAR file has been created, you can find it in your project's
"dist" folder.  If you go there now, you should see your JAR.</p>

<p>Remember that your JAR file has the same name as your library project
name, unless you changed it by editing the project.properties file.</p>

<a name="toLib"><b>Add the JAR to the Library:</b></a>

<p>To add the shapes JAR to your library, simply copy the file and
move it into your library folder!  That's it!</p>

<p>When you make changes to classes in your library, you'll need to
update your JAR using "Clean and Build", and you'll need to copy
the updated JAR file to your library.</p>

<a name="using"></a>
<h3>Using Your Library</h3>

<p>We're done with the original shapes class, so you can close that
project.  You might want to leave your shape library project open in
case you find any bugs or errors in the remainder of this tutorial.</p>

<p>To use your library in another project, you just add it to the
project by using the Library node or the Library settings of the
project properties window.  For example, let's create a test project
that uses an array of various shape objects.</p>

<ol>
    <li>From the main menu, open a new Java application.  You can call this
    project something like "TestLibrary", or your professor might have
    a different suggestion if this project is to be used for another topic
    during class.</li>
    <li>Make sure you add a test/main class.</li>
    <li>For this project, use whatever package naming convention you've been
    using throughout the course (e.g. prog24178.week1 or prog21478.deploy).</li>
    <li>Once the project has been created (it should only contain the class
    with the main() method, for now), open the project's node in the Project
    window, if it's not already open.</li>
    <li>You'll see a node called "Libraries".  Right-click this node and
    select "Add JAR/Folder"</li>
    <li>Browse to your library folder and open it.  You should see the .jar file
    that you pasted there earlier.</li>
    <li>Select your .jar file and click the Open button.</li>
</ol>
<p><img src="images/testClassLib.jpg" alt="test class library" /></p>

<p>That's it!  Let's try it out!</p>

<p>Go to the main method of your test project and add some code that uses your
Shape objects.  Examples:</p>

<pre>Shape[] shapes = new Shape[5];</pre>

<pre>Circle circle = new Circle(5);
Cylinder cyl = new Cylinder(2, 3);</pre>

<p>You'll notice that your statements turns red!  If you hover over the
red lines, you'll see that it can't understand your reference to the
Shape class.  If you click the icon on the left, you'll see that
it offers you the option to import the Shape class from the
shapes package!</p>

<p>Rather than import just the Shape class, let's import all the shapes
classes.  Add the import prog24178.shapes.*; statement to your test
class (use whatever package name you defined earlier).</p>

<p>You can now use the classes and methods in the Shapes class in
your project!</p>


<!--
<p>Now, we'll create a class called <b>xxxGuiUtils</b> (make sure the <b>xxx</b> characters are YOUR initials, for example KtcGuiUtils or McGuiUtils) that will contain a variety of useful "utility" methods.  Our first method will be one that prompts the user to exit using JOptionPane's confirm dialog box.  If the user clicks Yes, the method will return true; otherwise it will return false.</p>

<p>Open up a new program in EditPlus and add the method - don't forget to make it static, as it is not a method that operates on an object!</p>

<p>Save your source file in your <font face="Courier New">librarysource</font> folder and compile it.  Then <i>move</i> your .CLASS file ( cut-and-paste it - don't copy it!) to your <font face="Courier New">library</font> folder.</p>

<p>Now that we have some code in our code library, let's write a program that uses it!  For example:</p>

<pre>import javax.swing.*;

public class TestLibrary 
{
  public static void main(String[] args) 
  {
     JOptionPane.showMessageDialog(null, 
       "Testing my library...", "Testing", 
       JOptionPane.WARNING_MESSAGE);
	 
	 // note that my utils class is called WsjGuiUtils - yours will
	 // be something else
     if (WsjGuiUtils.exitOk("Are you sure you wish to exit?") == true)
       System.exit(0);
	}
}</pre>

<p>The utility class is in our library, and we told Java that it should search our library folder for classes it doesn't recognize.  When this program is run, Java locates the definition for the exitOk() method in the utility class in the library folder.</p>

<p>You can now put any code you want to reuse in the library folder!  Just remember to fully qualify your method names with the name of your class.</p>
-->

<a name="ex"></a><h3>Exercises</h3>

<p>Many times you'll have a set of static methods that you'd like to use
in a variety of programs.  Let's start off with a simple utilities class
that contains some methods you might find useful:</p>
<ol>
    <li>Create a class library</li>
    <li>Add a new package to it (for example, I will call mine wsj.terminallearning.utils)</li>
    <li>Add a class to contain your static methods (I will call mine WsjUtils)</li>
</ol>

<p><b>1.</b> Making a rightJustify() method</p>

<p>This method is useful when you want to print a text value formatted
to be right justified instead of the default of left justified.  This is
helpful when you're doing column headings or reports with mixed data types.
For example, it can be used to line up numeric values on the decimal point.</p>

<p>To right justify, you need to know how many character spaces a value
    should display in.  For example, say you decide to display a set of
    numberic floating point values displayed in 7 character spaces.
    If a value is 1.00 (4 characters) then you will need an additional 3
    character spaces to the left of the value to force it to be right
    justified.  If a value is 10.00 (5 chars) you need 2 spaces to
    the left to make it right justified.  You can use a loop to
    concatenate size-length spaces:</p>

<pre>public static String rightJustify(String value, int size) {
     int numSpaces = size - value.length();
     for (int i=1; i<=numSpaces; i++)
          value = " " + value;
     return value;
}</pre>

<p>Add this static method to your library Utils class and build your JAR
    file.</p>

<p>Try this method out in your Application that you created in the previous
    class to test your Shapes library:

<p>To use:</p>
<pre>// print some numbers
System.out.println(WsjUtils.rightJustify(".2", 6));
System.out.println(WsjUtils.rightJustify("1.23", 6));
System.out.println(WsjUtils.rightJustify("74", 6));</pre>

<p><b>2.</b> Making an Exit method</p>

<p>How often do you use a confirm dialog to confirm program termination
with the user? Often enough to copy and paste it every time?  This method
will be handy: you won't have to copy and paste the same long statement
into your GUI program every time!</p>

<p>Add a static method that asks the user, "Are you sure you wish to exit?"
    using a Confirm dialog from the JOptionPane class.  The method should
    return true if they say yes, false if they don’t.</p>
<p>Add this method to your Utils library and rebuild the JAR.  Note that
<b>you'll need to copy the new version of your JAR to your library
    folder</b>.</p>

<p>To use:</p>
<pre>if (WsjUtils.exitOk())
    System.exit(0);</pre>



<p>Test this out in your test application.  If you're testing on the console
then you might want to add an else to your if-statement, such as:</p>

<pre>if (WsjUtils.exitOk())
    System.exit(0);
else
    System.out.println("Kidding, exiting anyway.");</pre>

<p><b>NOTE: </b> An even BETTER version of this method will accept the exit
    message as a String paramter!  Then the programmer can display any exit
message they like such as "Are you quitting?"  or "Do you really want to
exit?"</p>

<p><b>3.</b> Making a method useful with KeyEvent Handlers</p>

<p>When you learned to handle keyboard events, you probably did an
example where a user can only type digits into a text field (or maybe
all characters, or whatever).  This sample method can be one of many
methods that will be useful for key event handling.</p>

<p>Add a static method ignoreNonDigit(char key) that checks to
    see if the given key character is not a digit. If the character is
    a digit, return it.  Otherwise, return the null-char '\0'.  Recall that
    replacing a typed key with the null-char will appear to the user that
    their key presses are doing nothing.</p>

<p>Your method should be static and accept a char param representing the key
    that you need to test.  The method should examine the char to see if
    it isn't a digit (hint: Character.isDigit(chVal)).  If it isn't a digit,
    return '\0', otherwise just return the original char param value.</p>

<p>To test this out in a keyPressed() event:</p>
<pre>char key = event.getKeyChar();
event.setKeyChar(WsjUtils.tossNotDigit(key));</pre>

<p>To test this in a console program:</p>
<pre>System.out.println("digit? " + WsjUtils.tossNotDigit('n'));
System.out.println("digit? " + WsjUtils.tossNotDigit('1'));</pre>


<!--
<p><b>2. </b> When working with arrays, there are a number of common
tasks that you perform.  You might wish to have an arrays package that
contains useful array methods.  For example, overloaded methods that
calculate and return the average of an array of numeric values, methods
that find the maximum or minimum value from an array, and methods that
return the sum of a numeric arrays' values.</p>
-->

<!--
<p>What if we wanted a similar method to use in a console application?
Create a xxxConsoleUtils class (xxx is your initials) and give it a
method called exitOk() that performs the same tast as xxxGuiUtils.exitOk(), except on the console.</p>

<p>One of the key things to understand about a code library is that your methods must be as reusable as possible.  For example, which calcAvg() method will be easier to implement in <i>any</i> program?</p>

<pre>// EXAMPLE 1
import java.io.*;

public class Stuff 
{
	public static void main(String[] args) 
	{
		BufferedReader br = new BufferedReader(new 
			InputStreamReader(System.in));
		System.out.println("Enter the first temperature.");
		int t1 = Integer.parseInt(br.readLine());
		System.out.println("Enter the second temperature.");
		int t2 = Integer.parseInt(br.readLine());
		System.out.println("Enter the third temperature.");
		int t3 = Integer.parseInt(br.readLine());
		
		double avg = calcAvg(t1, t2, t3);
		
		System.out.println("Average temperature: " + avg)
	}
	
	public static double calcAvg(int val1, int val2, int val3) {
		return (val1 + val2 + val3) / 3;
	}
}</pre>

<pre>// EXAMPLE 2
import java.io.*;

public class Stuff 
{
	public static void main(String[] args) 
	{
		BufferedReader br = new BufferedReader(new 
			InputStreamReader(System.in));
		System.out.println("Enter the first temperature.");
		int t1 = Integer.parseInt(br.readLine());
		System.out.println("Enter the second temperature.");
		int t2 = Integer.parseInt(br.readLine());
		System.out.println("Enter the third temperature.");
		int t3 = Integer.parseInt(br.readLine());
		
		calcAvg(t1, t2, t3);
		
		System.out.println("Average temperature: " + avg)
	}
	
	public static void calcAvg(int val1, int val2, int val3) {
		System.out.println((val1 + val2 + val3) / 3);
	}
}</pre>

<pre>// EXAMPLE 3
import java.io.*;

public class Stuff 
{
	private int t1, t2, t3;
	private double avg;

	public static void main(String[] args) 
	{
		BufferedReader br = new BufferedReader(new 
			InputStreamReader(System.in));
		System.out.println("Enter the first temperature.");
		t1 = Integer.parseInt(br.readLine());
		System.out.println("Enter the second temperature.");
		t2 = Integer.parseInt(br.readLine());
		System.out.println("Enter the third temperature.");
		t3 = Integer.parseInt(br.readLine());
		
		calcAvg();
		
		System.out.println("Average temperature: " + avg)
	}
	
	public static void calcAvg() {
		avg = (val1 + val2 + val3) / 3;
	}
}</pre>

<p>If you wanted to place the calcAvg() method from Examples 2 and 3 into a library, you'd have some problems:</p>
<ul class="outer">
	<li>Example 2:
	<ul class="inner">
		<li>This calcAvg() method can only be used with a console program.  It can't be used with a GUI program or an applet.
	</ul>
	<li>Example 3:
	<ul class="inner">
		<li>This calcAvg() method is assuming that any program using this method has the values stored in instance variables called t1, t2, and t3.
		<li>This method also assumes that any program using this method has an instance variable called avg.
	</ul>
</ul>

<p>Example 3's method demonstrates a problem of <b>strong coupling</b>.  Code that is strongly coupled is code that depends on some other piece of code in the program or class.  In this example, the method calcAvg() depends a great deal on the t1, t2, t3, and avg variables.  You could not use this method in just any program; the programmer would have to make sure they had those four variables declared as instance variables.  This is not a desirable situation!  If you modified the method, it might not work in all the other programs where it's being used!  You should be able to reuse code without modifying that code.</p>

<p>For these reasons, Example 1 is the best option.  The method takes the three values to average, and returns the result.  This method can be used in any program that needs an average of three integers.</p>

-->

<script typte="text/javascript" src="scripts/copynote.js"></script>

</body>
</html>
